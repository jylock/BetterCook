<div class="text-left" id="list">
	<!-- <div class="media">
		<div class="media-left">
			<img src="img_avatar1.png" class="media-object" style="width:60px">
		</div>
		<div class="media-body">
			<h4 class="media-heading">John Doe</h4>
			<p>Lorem ipsum...</p>
		</div>
	</div> -->
</div>
<script type="text/javascript">
function looseComparison(query, cuisine, recipe) {
	var q = query.toUpperCase();
	var c = cuisine.toUpperCase();
	var r_id = recipe.ID.toUpperCase();
	var r_title = recipe.Title.toUpperCase();
	var r_cuisine = recipe.Cuisine.toUpperCase();

	var f_id = (q.indexOf(r_id) > -1) || (r_title.indexOf(q) > -1);
	var f_cuisine = (r_cuisine.indexOf(c) > -1) || (r_title.indexOf(c) > -1);
	if(c === ""){ 
		f_cuisine = false;
	}
	if(q === ""){
		f_id = true;
	}
	return f_id || f_cuisine;
}

// Test for lemon
function looseComparison2(query, recipe) {
	var q = query.toUpperCase();
	var r_title = recipe.Title.toUpperCase();
	return q.indexOf("LEMON") > -1 && r_title.indexOf("HUMMUS") > -1;
}

function completeComparison(recipe) {
	var query = sessionStorage.getItem("query");
	var cuisine = sessionStorage.getItem("cuisine");
	var meal = sessionStorage.getItem("meal");
    var mins = sessionStorage.getItem("mins");
    var dollars = sessionStorage.getItem("dollars");
    var calories = sessionStorage.getItem("calories");

    var diet = sessionStorage.getItem("diet");


    var query_f = true;
    var cuisine_f = true;
    var meal_f = true;
    var mins_f = true;
    var dollars_f = true;
    var calories_f = true;

    // Check query match for ingredients
    if(query === "NA"){
    	query_f = true;
    }
    else if(query.indexOf(',') > -1){
    	var ingredients = query.split(',');
    	for(var i in ingredients){
    		var ingredient = ingredients[i].trim();
    		var hit = false;
    		for(var j in recipe.Ingredients){
    			if(recipe.Ingredients[j].indexOf(ingredient) > -1){
    				hit = true;
    				break;
    			}
    		}
    		if(hit === false){
    			query_f = false;
    			break;
    		}
    	}
    }
    else{
    	var terms = query.split(' ');
    	var match = false;
    	for(var k in terms){
    		var term = terms[k].trim().toUpperCase();
    		if(recipe.Title.toUpperCase().indexOf(term) > -1){
    			match = true;
    			break;
    		}
    		
    		for(var p in recipe.Ingredients){
    			if(recipe.Ingredients[p].toUpperCase().indexOf(term) > -1){
    				match = true;
    				break;
    			}
    		}
    		if(match === true){
    			break;
    		}
    	}
    	if(match === true){
    		query_f = true;
    	}else{
    		query_f = false;
    	}
    }

    if(cuisine !== "NA"){
    	cuisine_f = recipe.Cuisine.indexOf(cuisine) > -1;
    }

    if(meal !== "NA"){
    	meal_f = recipe.MealType.indexOf(meal) > -1;
    }

    if(mins !== "NA"){
    	mins_f = parseInt(mins) >= recipe.Time;
    }

    if(dollars !== "NA"){
    	dollars_f = parseInt(dollars) >= recipe.Budget;
    }
    
    if(calories !== "NA"){
    	calories_f = parseInt(calories) >= recipe.Calories;
    }
    
    // console.log("query_f = " + query_f);
    // console.log("cuisine_f = " + cuisine_f);
    // console.log("meal_f = " + meal_f);
    // console.log("mins_f = " + mins_f);
    // console.log("dollars_f = " + dollars_f);
    // console.log("calories_f = " + calories_f);

    return query_f && cuisine_f && meal_f && mins_f && dollars_f && calories_f;
}

$(document).ready(function(){
	$.get( "/allrecipes", function( data ) {

	var recipes = JSON.parse(data);
	var query = sessionStorage.getItem("query");
	var no_results_f = false;
	for(var i in recipes){
		var rating = Math.floor((Math.random() * 5) + 1);
		if(completeComparison(recipes[i])){
			$("#list").append("<a href='#'" + "class='result' id='"+ recipes[i].ID + "'>" + 
							"<div class='media'>" +
							"<div class='media-left'>" +
								"<img src='" + recipes[i].ImgURL + "' " + "class='media-object' style='width:60px'>" +
							"</div>" +
							"<div class='media-body'>" +
								"<h4 class='media-heading'>" + recipes[i].Title + "</h4>" +
								"<div class='row'>" +
									"<div class='col-md-6'>" +
										"<p>Time: " + recipes[i].Time + "</p>" +
										"<p>Calories:" + recipes[i].Calories + "</p>" +
										"<p>Budget:" + recipes[i].Budget + "</p>" +
									"</div>" +
									"<div class='col-md-6'>" +
										"<p>Cuisine: " + recipes[i].Cuisine + "</p>" +
										"<p>MealType: " + recipes[i].MealType + "</p>" +
										"<p>Serves: " + recipes[i].Serves + "</p>" +
									"</div>" +
								"</div>" +
								"<div class='row'>" +
									"<p>&nbsp;&nbsp;&nbsp;&nbsp;rating: "+ rating + "</p>" +
								"</div>" +
							"</div>" +
						  "</div>" + 
						  "</a>");
		$("#list").append("<hr>");
		no_results_f = true;
	}
	
	}
	if(no_results_f === false){
		$("#list").append("<h4>No results found for \"" + query + "\"</h4>");
	}

	});
});
</script>